{"version":3,"file":"507.52bf82f326d105244fc1.js","mappings":"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","sources":["webpack://@mattermost/webapp/./components/authorize/authorize.tsx","webpack://@mattermost/webapp/./components/authorize/index.ts"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\n\nimport React, {ReactNode} from 'react';\nimport {FormattedMessage} from 'react-intl';\n\nimport {OAuthApp} from '@mattermost/types/integrations';\n\nimport icon50 from 'images/icon50x50.png';\nimport FormError from 'components/form_error';\nimport {browserHistory} from 'utils/browser_history';\nimport FormattedMarkdownMessage from 'components/formatted_markdown_message.jsx';\n\nexport type Params = {\n    responseType: string | null;\n    clientId: string | null;\n    redirectUri: string | null;\n    state: string | null;\n    scope: string | null;\n}\n\ntype Props = {\n    location: {\n        search: string;\n    };\n    actions: {\n        getOAuthAppInfo: (clientId: string | null) => Promise<{data: OAuthApp; error?: Error}>;\n        allowOAuth2: (params: Params) => Promise<{data?: any; error?: Error}>;\n    };\n}\n\ntype State = {\n    app?: OAuthApp;\n    error?: string;\n}\n\nexport default class Authorize extends React.PureComponent<Props, State> {\n    public constructor(props: Props) {\n        super(props);\n\n        this.state = {};\n    }\n\n    public componentDidMount(): void {\n        // if we get to this point remove the antiClickjack blocker\n        const blocker = document.getElementById('antiClickjack');\n        if (blocker && blocker.parentNode) {\n            blocker.parentNode.removeChild(blocker);\n        }\n        const clientId = (new URLSearchParams(this.props.location.search)).get('client_id');\n        if (clientId && !((/^[a-z0-9]+$/).test(clientId))) {\n            return;\n        }\n\n        this.props.actions.getOAuthAppInfo(clientId).then(\n            ({data}) => {\n                if (data) {\n                    this.setState({app: data});\n                }\n            });\n    }\n\n    public handleAllow = (): void => {\n        const searchParams = new URLSearchParams(this.props.location.search);\n        const params = {\n            responseType: searchParams.get('response_type'),\n            clientId: searchParams.get('client_id'),\n            redirectUri: searchParams.get('redirect_uri'),\n            state: searchParams.get('state'),\n            scope: searchParams.get('store'),\n        };\n\n        this.props.actions.allowOAuth2(params).then(\n            ({data, error}) => {\n                if (data && data.redirect) {\n                    window.location.href = data.redirect;\n                } else if (error) {\n                    this.setState({error: error.message});\n                }\n            },\n        );\n    }\n\n    public handleDeny = (): void => {\n        const redirectUri = (new URLSearchParams(this.props.location.search)).get('redirect_uri');\n        if (redirectUri && (redirectUri.startsWith('https://') || redirectUri.startsWith('http://'))) {\n            window.location.href = redirectUri + '?error=access_denied';\n            return;\n        }\n\n        browserHistory.replace('/error');\n    }\n\n    public render(): ReactNode {\n        const app = this.state.app;\n        if (!app) {\n            return null;\n        }\n\n        let icon;\n        if (app.icon_url) {\n            icon = app.icon_url;\n        } else {\n            icon = icon50;\n        }\n\n        let error;\n        if (this.state.error) {\n            error = (\n                <div className='prompt__error form-group'>\n                    <FormError error={this.state.error}/>\n                </div>\n            );\n        }\n\n        return (\n            <div className='container-fluid'>\n                <div className='prompt'>\n                    <div className='prompt__heading'>\n                        <div className='prompt__app-icon'>\n                            <img\n                                alt={'prompt icon'}\n                                src={icon}\n                                width='50'\n                                height='50'\n                            />\n                        </div>\n                        <div className='text'>\n                            <FormattedMarkdownMessage\n                                id='authorize.title'\n                                defaultMessage='Authorize **{appName}** to Connect to Your **Mattermost** User Account'\n                                values={{\n                                    appName: app.name,\n                                }}\n                            />\n                        </div>\n                    </div>\n                    <p>\n                        <FormattedMarkdownMessage\n                            id='authorize.app'\n                            defaultMessage='The app **{appName}** would like the ability to access and modify your basic information.'\n                            values={{\n                                appName: app.name,\n                            }}\n                        />\n                    </p>\n                    <h2 className='prompt__allow'>\n                        <FormattedMarkdownMessage\n                            id='authorize.access'\n                            defaultMessage='Allow **{appName}** access?'\n                            values={{\n                                appName: app.name,\n                            }}\n                        />\n                    </h2>\n                    <div className='prompt__buttons'>\n                        <button\n                            type='submit'\n                            className='btn btn-link authorize-btn'\n                            onClick={this.handleDeny}\n                        >\n                            <FormattedMessage\n                                id='authorize.deny'\n                                defaultMessage='Deny'\n                            />\n                        </button>\n                        <button\n                            type='submit'\n                            className='btn btn-primary authorize-btn'\n                            onClick={this.handleAllow}\n                        >\n                            <FormattedMessage\n                                id='authorize.allow'\n                                defaultMessage='Allow'\n                            />\n                        </button>\n                    </div>\n                    {error}\n                </div>\n            </div>\n        );\n    }\n}\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\n\nimport {connect} from 'react-redux';\nimport {bindActionCreators, Dispatch, ActionCreatorsMapObject} from 'redux';\n\nimport {GenericAction, ActionFunc} from 'mattermost-redux/types/actions';\nimport {OAuthApp} from '@mattermost/types/integrations';\n\nimport {allowOAuth2, getOAuthAppInfo} from 'actions/admin_actions.jsx';\n\nimport Authorize, {Params} from './authorize';\n\ntype Actions = {\n    getOAuthAppInfo: (clientId: string | null) => Promise<{data: OAuthApp; error?: Error}>;\n    allowOAuth2: (params: Params) => Promise<{data?: any; error?: Error}>;\n}\n\nfunction mapDispatchToProps(dispatch: Dispatch<GenericAction>) {\n    return {\n        actions: bindActionCreators<ActionCreatorsMapObject<ActionFunc>, Actions>({\n            getOAuthAppInfo,\n            allowOAuth2,\n        }, dispatch),\n    };\n}\n\nexport default connect(null, mapDispatchToProps)(Authorize);\n"],"names":["React","FormattedMessage","icon50","FormError","browserHistory","FormattedMarkdownMessage","Authorize","PureComponent","constructor","props","searchParams","URLSearchParams","location","search","params","responseType","get","clientId","redirectUri","state","scope","actions","allowOAuth2","then","data","error","redirect","window","href","setState","message","startsWith","replace","componentDidMount","blocker","document","getElementById","parentNode","removeChild","test","getOAuthAppInfo","app","render","icon","icon_url","appName","name","handleDeny","handleAllow","connect","bindActionCreators","mapDispatchToProps","dispatch"],"sourceRoot":""}